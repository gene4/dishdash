datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model Ingredient {
  id                       String      @id @default(uuid())
  name                     String
  userId                   String
  vat                      String
  category                 String

  deliveryPrices             DeliveryPrice[] @relation("deliveryPrices")
  
  selectedDeliveryPrice      DeliveryPrice?   @relation("selecteDelivery", fields: [selectedDeliveryPriceId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  selectedDeliveryPriceId    String?    @unique

  recipes      RecipeIngredient[]
  dishes       DishIngredient[]

}

model DeliveryPrice {
  id           String      @id @default(uuid()) 
  unit         String
  weight       Float?
  amount       Float
  price        Float
  bruttoPrice  Float?
  date         DateTime 

  delivery     Delivery?    @relation(fields: [deliveryId], references: [id])
  deliveryId   String?

  supplier    Supplier?    @relation(fields: [supplierId], references: [id])
  supplierId  String?

  ingredient   Ingredient @relation("deliveryPrices",fields: [ingredientId], references: [id])
  ingredientId String

  selectedFor   Ingredient?   @relation("selecteDelivery") 
  
@@index([deliveryId])
@@index([ingredientId])
@@index([supplierId])
}

model Recipe {
  id              String      @id @default(uuid()) 
  name            String
  userId          String
  unit            String
  yield           Float
  ingredients     RecipeIngredient[]
  dishes          DishIngredient[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model RecipeIngredient {
  id              String      @id @default(uuid()) 
  amount          Float

  recipe          Recipe   @relation(fields: [recipeId], references: [id])
  recipeId        String

  ingredient      Ingredient @relation(fields: [ingredientId], references: [id])
  ingredientId    String

@@index([recipeId])
@@index([ingredientId])
}


model Dish {
  id              String      @id @default(uuid()) 
  name            String
  userId          String
  menuPrice       Float
  vat             String
  multiplier      Float
  ingredients     DishIngredient[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model DishIngredient {
  id              String      @id @default(uuid()) 
  amount          Float

  dish            Dish   @relation(fields: [dishId], references: [id])
  dishId          String

  ingredient      Ingredient? @relation(fields: [ingredientId], references: [id])
  ingredientId    String?

  recipe          Recipe? @relation(fields: [recipeId], references: [id])
  recipeId        String?

@@index([dishId])
@@index([ingredientId])
@@index([recipeId])
}

model Supplier {
  id          String      @id @default(uuid()) 
  name        String
  userId      String
  paymentInfo String? @db.Text
  paymentDay  Int?
  deliveries  Delivery[] 
  deliveryPrices DeliveryPrice[]

  createdAt   DateTime    @default(now())
}

model Delivery {
  id          String      @id @default(uuid()) 
  userId      String
  items       DeliveryPrice[]
  invoiceNr   String?
  date        DateTime 
  fileUrl     String? @db.Text
  fileRef     String? @db.Text
 
  supplier    Supplier    @relation(fields: [supplierId], references: [id])
  supplierId  String

  createdAt   DateTime    @default(now())

  @@index([supplierId])
}