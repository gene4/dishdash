datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model Ingredient {
  id        String      @id @default(uuid())
  name      String
  userId    String
  unit      String
  amount    Float
  price     Float
  createdAt DateTime @default(now())
  supplier    String
  category    String
  recipes     RecipeIngredient[]
  dishes      DishIngredient[]
  updatedAt DateTime @updatedAt

}

model Recipe {
  id        String      @id @default(uuid()) 
  name      String
  userId    String
  unit      String
  yield     Float
  ingredients     RecipeIngredient[]
  dishes      DishIngredient[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RecipeIngredient {
  id        String      @id @default(uuid()) 
  amount    Float

  recipe    Recipe   @relation(fields: [recipeId], references: [id])
  recipeId   String

  ingredient Ingredient @relation(fields: [ingredientId], references: [id])
  ingredientId String

@@index([recipeId])
@@index([ingredientId])
}


model Dish {
  id        String      @id @default(uuid()) 
  name      String
  userId    String
  targetPrice Float
  multiplier Float
  ingredients     DishIngredient[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DishIngredient {
  id        String      @id @default(uuid()) 
  amount    Float

  dish     Dish   @relation(fields: [dishId], references: [id])
  dishId   String

  ingredient Ingredient? @relation(fields: [ingredientId], references: [id])
  ingredientId String?

  recipe Recipe? @relation(fields: [recipeId], references: [id])
  recipeId String?

@@index([dishId])
@@index([ingredientId])
@@index([recipeId])
}

model Supplier {
  id        String      @id @default(uuid()) 
  name      String
  userId    String
  bills     Invoice[]
  createdAt DateTime    @default(now())
}

model Invoice {
  id          String      @id @default(uuid()) 
  userId      String

  supplierId  String
  supplier    Supplier    @relation(fields: [supplierId], references: [id])


  invoiceNr   String
  date        DateTime 
  status      String
  amount      Float
  fileUrl     String? @db.Text
  fileRef     String? @db.Text
  createdAt DateTime    @default(now())

  @@index([supplierId])
}