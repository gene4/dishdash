datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}


model Ingredient {
  id                       String      @id @default(uuid())
  name                     String
  userId                   String
  vat                      String
  category                 String


  variants                 IngredientVariant[] 
  deliveryPrices           DeliveryPrice[] @relation("deliveryPrices")
  
  selectedDeliveryPrice    DeliveryPrice?   @relation("selecteDelivery", fields: [selectedDeliveryPriceId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  selectedDeliveryPriceId  String?    @unique

  recipes      RecipeIngredient[]
  dishes       DishIngredient[]

}

model IngredientVariant {
  id                       String      @id @default(uuid())
  name                     String
  wightPerPiece            Float?
  
  parentIngredient         Ingredient @relation(fields: [parentIngredientId], references: [id])
  parentIngredientId       String

  deliveryPrices           DeliveryPrice[] 

  @@index([parentIngredientId])
}




model DeliveryPrice {
  id           String      @id @default(uuid()) 
  unit         String
  amount       Float
  price        Float
  date         DateTime 

  delivery     Delivery?    @relation(fields: [deliveryId], references: [id])
  deliveryId   String?

  supplier    Supplier?    @relation(fields: [supplierId], references: [id])
  supplierId  String?

  ingredientVariant    IngredientVariant?    @relation(fields: [ingredientVariantId], references: [id])
  ingredientVariantId  String? 

  ingredient   Ingredient @relation("deliveryPrices",fields: [ingredientId], references: [id])
  ingredientId String

  selectedFor   Ingredient?   @relation("selecteDelivery") 
  
@@index([deliveryId])
@@index([ingredientId])
@@index([supplierId])
@@index([ingredientVariantId])
}

model Credit {
    id           String      @id @default(uuid()) 
    amount       Float
    date         DateTime 

    delivery     Delivery?    @relation(fields: [deliveryId], references: [id])
    deliveryId   String? @unique

    supplier    Supplier?    @relation(fields: [supplierId], references: [id])
    supplierId  String?


    @@index([deliveryId])
    @@index([supplierId])
}


model Recipe {
  id              String      @id @default(uuid()) 
  name            String
  userId          String
  unit            String
  yield           Float
 
  ingredients     RecipeIngredient[]
  dishes          DishIngredient[]
  recipes         RecipeIngredient[] @relation("recipeIngredientId")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model RecipeIngredient {
  id              String      @id @default(uuid()) 
  amount          Float
  unit            String

  recipe          Recipe   @relation(fields: [recipeId], references: [id])
  recipeId        String

   ingredient      Ingredient? @relation(fields: [ingredientId], references: [id])
  ingredientId     String?

   recipeIngredient    Recipe? @relation("recipeIngredientId", fields: [recipeIngredientId], references: [id])
  recipeIngredientId   String? 



@@index([recipeIngredientId])
@@index([ingredientId])
@@index([recipeId])
}




model Dish {
  id              String      @id @default(uuid()) 
  name            String
  userId          String
  menuPrice       Float
  vat             String
  multiplier      Float
  ingredients     DishIngredient[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model DishIngredient {
  id              String      @id @default(uuid()) 
  amount          Float
  unit            String

  dish            Dish   @relation(fields: [dishId], references: [id])
  dishId          String

  ingredient      Ingredient? @relation(fields: [ingredientId], references: [id])
  ingredientId    String?

  recipeIngredient          Recipe? @relation(fields: [recipeIngredientId], references: [id])
  recipeIngredientId        String?

@@index([dishId])
@@index([ingredientId])
@@index([recipeIngredientId])
}

model Supplier {
  id          String      @id @default(uuid()) 
  name        String
  userId      String
  paymentInfo String? @db.Text
  deliveries  Delivery[] 
  deliveryPrices DeliveryPrice[]
  credits     Credit[]

  createdAt   DateTime    @default(now())
}

model Delivery {
  id          String      @id @default(uuid()) 
  userId      String
  items       DeliveryPrice[]
  invoiceNr   String?
  date        DateTime 
  fileUrl     String? @db.Text
  fileRef     String? @db.Text
  credit      Credit?
 
  supplier    Supplier    @relation(fields: [supplierId], references: [id])
  supplierId  String

  createdAt   DateTime    @default(now())

  @@index([supplierId])
}